{% extends 'main/base.html' %}

{% block title %}{{ run.game_category.game.name }} {{ run.game_category.category.name }}{% endblock %}

{% block content %}
<p><img src="{{ run.game_category.game.banner.url }}" height=100 wigth=640></p>
<h1>{{ run.game_category.game.name }}: {{ run.game_category.category.name }}</h1>
<p>{{ run.game_category.extra_description }}</p>
{% if not run.is_validated %}
{% if run.is_rejected %}
<p><b>Этот забег отклонен модератором!</b></p>
{% else %}
<p><i>Этот забег требует подтверждения!</i></p>
{% endif %}
{% endif %}
<p>Итоговое время:</p>
<ul><li>{{ run.get_runtime_str }}</li></ul>
<p>Видео:</p>
<ul><li>{{ run.video_link }}</li></ul>
<p>Пользователь: <a href="{% url 'users:profile' run.user.slug %}">{{ run.user.username }}</a></p>
<p>Загружен {{ run.time_uploaded }}</p>
{% if moderator and moderator.can_validate_runs and run.user.id != user.id %}
<form action="{% url 'main:run' run.id %}" method="post">
    {% csrf_token %}
    <p>
        <label for="{{ validation_form.validate_choice.id_for_label }}">Принять/Отклонить забег?</label>
        {{ validation_form.validate_choice }}
    </p>
    <p>
        <label for="{{ validation_form.reject_reason.id_for_label }}">Укажите причину отклонения</label>
        {{ validation_form.reject_reason }}
    </p>
    <p>
       <input type="submit">
    </p>
</form>
{% endif %}
{% if run.is_validated %}
{% if user.is_authenticated %}
<form action="{% url 'main:run' run.id %}" method="post">
    {% csrf_token %}
    <p>
        <label for="{{ report_form.validate_choice.id_for_label }}">Вы можете пожаловаться на забег</label>
        {{ report_form.report_text }}
    </p>
    <p>
       <input type="submit">
    </p>
</form>
<form action="{% url 'main:run' run.id %}" method="post">
    {% csrf_token %}
    <p>
        <label for="{{ comment_form.comment_text.id_for_label }}">Оставьте комментарий</label>
        {{ comment_form.comment_text }}
    </p>
    <p>
       <input type="submit">
    </p>
</form>
{% endif %}
<h3>Комментариев: {{ run.get_comments.count }}</h3>
<ul>
{% for comment in run.get_comments %}
    <li>
        <img src="{{ comment.user.pfp.url }}" height=20 width=20><a href="{% url 'users:profile' comment.user.slug %}">{{ comment.user.username }}</a> {{ comment.time }}
        <p>{{ comment.comment_text }}</p>
    </li>
{% endfor %}
</ul>
{% endif %}
{% endblock %}